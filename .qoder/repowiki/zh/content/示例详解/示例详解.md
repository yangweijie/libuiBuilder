# 示例详解

<cite>
**本文档中引用的文件**
- [simple.php](file://example/simple.php)
- [full.php](file://example/full.php)
- [responseGrid.php](file://example/responseGrid.php)
- [ResponsiveGridBuilder.php](file://src/ResponsiveGridBuilder.php)
- [ResponsiveGrid.php](file://src/Templates/ResponsiveGrid.php)
- [Builder.php](file://src/Builder.php)
- [GridBuilder.php](file://src/Components/GridBuilder.php)
- [ButtonBuilder.php](file://src/Components/ButtonBuilder.php)
- [EntryBuilder.php](file://src/Components/EntryBuilder.php)
- [helper.php](file://src/helper.php)
</cite>

## 目录
1. [简介](#简介)
2. [项目结构概览](#项目结构概览)
3. [简单示例分析 (simple.php)](#简单示例分析-simplephp)
4. [完整功能示例分析 (full.php)](#完整功能示例分析-fullphp)
5. [响应式网格示例分析 (responseGrid.php)](#响应式网格示例分析-responsegridphp)
6. [核心架构组件](#核心架构组件)
7. [最佳实践总结](#最佳实践总结)
8. [运行指导](#运行指导)
9. [故障排除指南](#故障排除指南)

## 简介

本文档深入解析了 libuiBuilder 库的三个核心示例文件，展示了该库的强大功能和最佳实践。通过分析这些示例，开发者可以掌握基础控件使用、复杂界面布局、响应式设计等关键技术。

libuiBuilder 是一个基于 PHP 的 GUI 构建库，提供了丰富的控件和灵活的布局系统。三个示例文件分别展示了从基础到高级的不同应用场景，是学习和参考的最佳实践案例。

## 项目结构概览

```mermaid
graph TB
subgraph "示例文件"
A[simple.php<br/>基础控件演示]
B[full.php<br/>完整功能演示]
C[responseGrid.php<br/>响应式网格]
end
subgraph "核心架构"
D[Builder<br/>构建器入口]
E[ResponsiveGridBuilder<br/>响应式网格构建器]
F[GridBuilder<br/>网格布局组件]
G[ButtonBuilder<br/>按钮组件]
H[EntryBuilder<br/>输入框组件]
end
subgraph "支持组件"
I[StateManager<br/>状态管理]
J[ComponentBuilder<br/>组件基类]
K[helper.php<br/>辅助函数]
end
A --> D
B --> D
C --> E
E --> F
D --> G
D --> H
D --> I
G --> J
H --> J
K --> A
```

**图表来源**
- [Builder.php](file://src/Builder.php#L1-L153)
- [ResponsiveGridBuilder.php](file://src/ResponsiveGridBuilder.php#L1-L82)
- [GridBuilder.php](file://src/Components/GridBuilder.php#L1-L120)

## 简单示例分析 (simple.php)

simple.php 展示了基础控件的使用、事件处理、状态更新和组件引用等核心功能。

### 主要特性

#### 1. 基础窗口构建
```mermaid
sequenceDiagram
participant App as 应用程序
participant Builder as Builder
participant Window as 窗口组件
participant VBox as 垂直盒子
App->>Builder : 创建窗口
Builder->>Window : 设置标题和尺寸
Window->>VBox : 添加垂直布局
VBox->>VBox : 添加子组件
App->>Window : 显示窗口
```

**图表来源**
- [simple.php](file://example/simple.php#L11-L140)

#### 2. 表单控件组合
示例展示了多种输入控件的组合使用：

| 控件类型 | 功能描述 | 关键配置 |
|---------|---------|---------|
| 单行输入框 | 用户姓名输入 | 验证、占位符、最大长度 |
| 密码输入框 | 安全密码输入 | 密码模式、最小长度验证 |
| 下拉选择框 | 性别选择 | 预设选项、选中回调 |
| 可编辑下拉框 | 爱好选择 | 可自定义选项 |

#### 3. 事件处理机制
```mermaid
flowchart TD
A[用户输入] --> B{输入类型}
B --> |姓名输入| C[更新欢迎标签]
B --> |密码输入| D[计算密码强度]
B --> |性别选择| E[控制台输出]
B --> |协议勾选| F[启用/禁用提交按钮]
C --> G[实时反馈]
D --> G
E --> G
F --> G
```

**图表来源**
- [simple.php](file://example/simple.php#L30-L82)

#### 4. 状态管理系统
示例展示了如何使用 StateManager 进行组件间通信：

```mermaid
classDiagram
class StateManager {
+instance() StateManager
+getComponent(id) Component
+registerComponent(component)
}
class ComponentRef {
+string id
+Component component
+getValue() mixed
+setValue(value) void
}
class EntryBuilder {
+onChange(callback) void
+getValue() string
+setValue(value) void
}
StateManager --> ComponentRef : 管理
ComponentRef --> EntryBuilder : 引用
```

**图表来源**
- [simple.php](file://example/simple.php#L30-L82)

**章节来源**
- [simple.php](file://example/simple.php#L1-L142)

## 完整功能示例分析 (full.php)

full.php 展示了复杂的界面布局、多级容器嵌套和各种控件的综合应用。

### 界面布局架构

```mermaid
graph TB
subgraph "主窗口"
A[垂直布局 VBox]
subgraph "输入区域"
B[网格布局 Grid]
C[单行输入]
D[多行输入]
end
subgraph "选择区域"
E[水平布局 HBox]
subgraph "复选框组"
F[选项1]
G[选项2]
H[选项3]
end
VSeparator[垂直分隔符]
subgraph "单选框组"
I[选项A]
J[选项B]
K[选项C]
end
end
subgraph "数值控件"
L[网格布局 Grid]
M[数字输入 Spinbox]
N[滑动条 Slider]
O[下拉选择 Combo]
end
subgraph "操作按钮"
P[水平布局 HBox]
Q[获取值按钮]
R[重置按钮]
end
end
A --> B
A --> E
A --> L
A --> P
E --> F
E --> G
E --> H
E --> VSeparator
E --> I
E --> J
E --> K
```

**图表来源**
- [full.php](file://example/full.php#L14-L179)

### 控件功能对比

| 控件类别 | 简单示例 | 完整示例 | 功能差异 |
|---------|---------|---------|---------|
| 输入控件 | 单行输入、密码输入 | 单行、多行、密码输入 | 多行输入支持换行 |
| 选择控件 | 下拉选择 | 复选框、单选框、下拉选择 | 更多样式选择 |
| 数值控件 | 无 | 数字输入框、滑动条 | 数值范围和交互 |
| 布局控件 | 分隔符 | 分隔符、网格布局 | 复杂布局组织 |

### 事件处理复杂度

```mermaid
sequenceDiagram
participant User as 用户
participant UI as 界面控件
participant Handler as 事件处理器
participant State as 状态管理器
participant Console as 控制台输出
User->>UI : 操作控件
UI->>Handler : 触发事件
Handler->>State : 获取组件状态
State-->>Handler : 返回当前值
Handler->>Console : 输出调试信息
Handler->>UI : 更新界面状态
```

**图表来源**
- [full.php](file://example/full.php#L125-L176)

**章节来源**
- [full.php](file://example/full.php#L1-L180)

## 响应式网格示例分析 (responseGrid.php)

responseGrid.php 展示了响应式网格布局的实现方式和断点配置。

### 响应式网格架构

```mermaid
classDiagram
class ResponsiveGrid {
+create(columns) ResponsiveGridBuilder
}
class ResponsiveGridBuilder {
-int totalColumns
-int currentRow
-int currentCol
-array items
+col(component, span) self
+newRow() self
+build() GridBuilder
}
class GridBuilder {
+place(component, row, col, rowSpan, colSpan) GridItemBuilder
+form(fields) self
+append(components) self
}
ResponsiveGrid --> ResponsiveGridBuilder : 创建
ResponsiveGridBuilder --> GridBuilder : 生成
```

**图表来源**
- [ResponsiveGrid.php](file://src/Templates/ResponsiveGrid.php#L8-L13)
- [ResponsiveGridBuilder.php](file://src/ResponsiveGridBuilder.php#L7-L82)

### 网格布局算法

```mermaid
flowchart TD
A[添加网格项] --> B{检查当前行空间}
B --> |空间充足| C[直接放置]
B --> |空间不足| D[换行]
D --> E[重置列位置]
E --> C
C --> F{设置对齐方式}
F --> |按钮类型| G[居中对齐，不拉伸]
F --> |其他类型| H[填充对齐，可拉伸]
G --> I[完成布局]
H --> I
```

**图表来源**
- [ResponsiveGridBuilder.php](file://src/ResponsiveGridBuilder.php#L19-L43)

### 断点配置策略

| 网格列数 | 设计目标 | 适用场景 | 布局特点 |
|---------|---------|---------|---------|
| 12列网格 | 响应式设计标准 | 大多数应用 | 灵活的12列栅格系统 |
| 1/4宽度 | 移动端适配 | 小屏幕设备 | 紧凑的四分之一布局 |
| 全宽布局 | 桌面端显示 | 大屏幕设备 | 占满整个可用空间 |

**章节来源**
- [responseGrid.php](file://example/responseGrid.php#L1-L25)
- [ResponsiveGridBuilder.php](file://src/ResponsiveGridBuilder.php#L1-L82)

## 核心架构组件

### Builder 构建器系统

Builder 类提供了统一的组件创建入口，采用静态工厂方法模式：

```mermaid
classDiagram
class Builder {
+window(config) WindowBuilder
+vbox(config) BoxBuilder
+hbox(config) BoxBuilder
+grid(config) GridBuilder
+button(config) ButtonBuilder
+label(config) LabelBuilder
+entry(config) EntryBuilder
+checkbox(config) CheckboxBuilder
+combobox(config) ComboboxBuilder
+passwordEntry(config) EntryBuilder
+multilineEntry(config) MultilineEntryBuilder
+spinbox(config) SpinboxBuilder
+slider(config) SliderBuilder
+progressBar(config) ProgressBarBuilder
+radio(config) RadioBuilder
+menu() MenuBuilder
+canvas(config) CanvasBuilder
+separator() SeparatorBuilder
+hSeparator(config) SeparatorBuilder
+vSeparator(config) SeparatorBuilder
+table(config) TableBuilder
+tab(config) TabBuilder
}
class ComponentBuilder {
<<abstract>>
#getDefaultConfig() array
#createNativeControl() CData
#applyConfig() void
#canHaveChildren() bool
#buildChildren() void
+build() CData
+contains(components) self
+id(id) self
+style(style) self
+tooltip(text) self
}
Builder --> ComponentBuilder : 创建
```

**图表来源**
- [Builder.php](file://src/Builder.php#L27-L152)

### 状态管理系统

```mermaid
sequenceDiagram
participant Component as 组件
participant StateManager as 状态管理器
participant Registry as 组件注册表
participant EventSystem as 事件系统
Component->>StateManager : 注册组件
StateManager->>Registry : 存储组件引用
Component->>EventSystem : 触发事件
EventSystem->>StateManager : 查询相关组件
StateManager->>Component : 返回组件实例
Component->>Component : 更新状态
```

**图表来源**
- [simple.php](file://example/simple.php#L30-L82)

### 辅助函数系统

helper.php 提供了密码强度计算等实用函数：

```mermaid
flowchart TD
A[密码输入] --> B[长度检查]
B --> C{长度 >= 6?}
C --> |是| D[分数+1]
C --> |否| E[反馈: 长度不足]
D --> F{长度 >= 8?}
F --> |是| G[分数+1]
F --> |否| H[继续检查]
G --> I[检查小写字母]
H --> I
I --> J{包含小写字母?}
J --> |是| K[分数+1]
J --> |否| L[反馈: 缺少小写字母]
K --> M[检查大写字母]
L --> M
M --> N{包含大写字母?}
N --> |是| O[分数+1]
N --> |否| P[反馈: 缺少大写字母]
O --> Q[检查数字]
P --> Q
Q --> R{包含数字?}
R --> |是| S[分数+1]
R --> |否| T[反馈: 缺少数字]
S --> U[检查特殊字符]
T --> U
U --> V{包含特殊字符?}
V --> |是| W[分数+1]
V --> |否| X[反馈: 缺少特殊字符]
W --> Y[计算强度等级]
X --> Y
Y --> Z{分数范围}
Z --> |0-2| AA[弱]
Z --> |3-4| BB[中]
Z --> |5-6| CC[强]
```

**图表来源**
- [helper.php](file://src/helper.php#L3-L58)

**章节来源**
- [Builder.php](file://src/Builder.php#L1-L153)
- [helper.php](file://src/helper.php#L1-L59)

## 最佳实践总结

### 1. 组件设计原则

- **单一职责**: 每个组件只负责一种特定的功能
- **链式调用**: 使用返回 $this 的方法支持流畅接口
- **配置驱动**: 通过配置数组控制组件行为
- **事件分离**: 将业务逻辑与界面更新分离

### 2. 状态管理策略

- **集中管理**: 使用 StateManager 统一管理所有组件状态
- **组件引用**: 通过 ID 系统建立组件间的引用关系
- **事件驱动**: 基于事件触发的状态更新机制
- **类型安全**: 通过类型提示确保参数正确性

### 3. 响应式设计模式

- **栅格系统**: 使用 12 列栅格系统提供灵活的布局方案
- **自动换行**: 智能的行溢出处理机制
- **对齐优化**: 根据控件类型自动调整对齐方式
- **弹性布局**: 支持不同屏幕尺寸的自适应布局

### 4. 代码组织规范

- **命名空间**: 使用清晰的命名空间结构
- **文件组织**: 按功能模块组织文件结构
- **注释规范**: 提供详细的代码注释和文档
- **错误处理**: 实现完善的错误处理机制

## 运行指导

### 环境要求

- PHP 8.0 或更高版本
- libui 扩展
- 相关依赖包

### 运行步骤

1. **安装依赖**
   ```bash
   composer install
   ```

2. **运行示例**
   ```bash
   php example/simple.php
   php example/full.php
   php example/responseGrid.php
   ```

### 开发建议

- **调试模式**: 启用详细错误报告进行开发调试
- **性能监控**: 使用内置的性能分析工具
- **测试覆盖**: 编写单元测试确保代码质量
- **文档维护**: 保持文档与代码同步更新

## 故障排除指南

### 常见问题及解决方案

| 问题类型 | 症状描述 | 可能原因 | 解决方案 |
|---------|---------|---------|---------|
| 界面无法显示 | 窗口创建失败 | libui 扩展未加载 | 检查扩展安装和配置 |
| 控件事件无效 | 点击无响应 | 事件绑定失败 | 检查回调函数定义 |
| 状态更新异常 | 数据不一致 | 状态管理器配置错误 | 验证组件 ID 和引用 |
| 布局错乱 | 控件位置异常 | 网格配置错误 | 检查列跨度和行间距设置 |

### 调试技巧

- **日志记录**: 启用详细的日志输出
- **断点调试**: 使用 IDE 断点调试功能
- **单元测试**: 编写针对性的单元测试
- **性能分析**: 使用性能分析工具识别瓶颈

通过深入分析这三个示例文件，开发者可以掌握 libuiBuilder 库的核心概念和最佳实践，为构建复杂的桌面应用程序奠定坚实基础。